= Modeling Recipes in 5 Simple Steps
:toc:
:toc-title:
:imagesdir: /images
:includedir: /cypher_queries

Cooking is an integral part of every home's daily life. Being able to quickly decide what you want to have for breakfast, lunch, and dinner, and then, with a click, to find a recipe that complies with your current diet, is the dream of every family. If you want to develop an application that can make millions of people happy by saving them time for their close ones, you are in the right place.

Neo4j not only helps businesses simplify their data; it also gives them the power to store, manage, and retrieve information efficiently and flexibly.

So, let me show you how easy it is to model a domain such as cooking recipies.

== Step 1: Create a Pancakes Recipe Model

image::{imagesdir}/Recipe.png[]

== Step 2: Add Labels and Properties

image::{imagesdir}/Entities.png[]

== Step 3: Import the Graph Model in Neo4j

[source,sql]
----
CREATE
  (`1` :Ingredient :Food {name:'Almond Flour'}) ,
  (`2` :Ingredient :Food {name:'Coconut Flour'}) ,
  (`3` :Ingredient :Food {name:'Almond milk'}) ,
  (`4` :Ingredient :Food {name:'egg'}) ,
  (`5` :Ingredient :Food {name:'baking powder'}) ,
  (`6` :Ingredient :Food {name:'vanilla extract'}) ,
  (`7` :Ingredient {name:'avocado oil'}) ,
  (`8` :Ingredient :Food {name:'sea salt'}) ,
  (`9` :Instruction {name:'Whisk all ingredients together in a bowl until smooth.',sequence:'1'}) ,
  (`10` :Instruction {name:'Preheat an oiled pan on the stove over medium-low to medium heat.',sequence:'2'}) ,
  (`11` :Instruction {name:'Drop the batter onto the hot pan and form into circles.',sequence:'3'}) ,
  (`12` :Instruction {name:'Cover and cook until bubbles start to form.',sequence:'4'}) ,
  (`13` :Instruction {name:'Flip and cook another until browned on the other side.',sequence:'5'}) ,
  (`14` :Recipe {name:'Pancakes',suitable_for:'HFLC',course:'breakfast',calories:'268 kcal',prep_time:'5 min',cook_time:'15 min',servings:'6'}) ,
  (`15` :Nutrition_Facts {serving_size:'Amount per serving',calories:'268 kcal',fat:'23 g',protein:'9 g',`total carbs`:'6 g'}) ,
  (`16` :Ingredient :Food {name:'pancake'}) ,
  (`1`)-[:`listed_in` ]->(`14`) ,
  (`2`)-[:`listed_in` ]->(`14`) ,
  (`3`)-[:`listed_in` ]->(`14`) ,
  (`4`)-[:`listed_in` ]->(`14`) ,
  (`5`)-[:`listed_in` ]->(`14`) ,
  (`6`)-[:`listed_in` ]->(`14`) ,
  (`7`)-[:`listed_in` ]->(`14`) ,
  (`8`)-[:`listed_in` ]->(`14`) ,
  (`14`)-[:`starts_with` ]->(`9`) ,
  (`9`)-[:`next_instruction` ]->(`10`) ,
  (`10`)-[:`next_instruction` ]->(`11`) ,
  (`11`)-[:`next_instruction` ]->(`12`) ,
  (`12`)-[:`next_instruction` ]->(`13`) ,
  (`13`)-[:`results_in` ]->(`16`),
  (`13`)-[:`next_instruction` ]->(`11`),
  (`14`)-[:`has_nutrition_facts` ]->(`15`),
  (`16`)-[:`has_nutrition_facts` ]->(`15`),
  (`16`)-[:`contains` {quantity:'1 cup'} ]->(`1`) ,
  (`16`)-[:`contains` {quantity:'1/4 cup'} ]->(`2`) ,
  (`16`)-[:`contains` {quantity:'1/3 cup'} ]->(`3`) ,
  (`16`)-[:`contains` {quantity:'3'} ]->(`4`) ,
  (`16`)-[:`contains` {quantity:'1 tsp'} ]->(`5`) ,
  (`16`)-[:`contains` {quantity:'1 tsp'} ]->(`6`) ,
  (`16`)-[:`contains` {quantity:'1/4 cup'} ]->(`7`) ,
  (`16`)-[:`contains` {quantity:'1/4 tsp'} ]->(`8`) ,
  (`14`)-[:`is_about` ]->(`16`) ,
  (`16`)-[:`is_prepared_through` ]->(`14`)
----


== Step 4: Show All Nodes and Relationships

[source,sql]
----
MATCH p = (n)-->() RETURN p
----

image::{imagesdir}/graph.png[]

== Step 5: Show Domain Schema

[source,sql]
----
call db.schema()
----

image::{imagesdir}/schema.png[]

== Let's Have Some Fun with the Data


=== Show me the Nutrition Facts of the "Pancakes" recipe

[source, sql]
----
MATCH (:Recipe {name: 'Pancakes'})-[:has_nutrition_facts]->(n:Nutrition_Facts)
RETURN n.`serving_size`,n.`calories`,n.`fat`,n.`protein`,n.`total carbs`
----
image::{imagesdir}/recipe_nutrition_facts.png[]

=== Give me the ingredients of a pancake
[source,sql]
----
MATCH (food:Food)-[:contains]->(Ingredient)
RETURN food.name AS Food, collect(Ingredient.name) AS Ingredients
----
image::{imagesdir}/recipe_ingredients.png[]

=== Give the quantity of each ingredient

[source,sql]
----
MATCH (food:Food)-[c:contains]-> (i:Ingredient)
RETURN  i.name AS Ingredient,c.quantity AS Quantity
ORDER BY c.quantity
----
image::{imagesdir}/ingredient_quantity.png[]

=== How to prepare pancakes with this recipe

[source,sql]
----
MATCH (r:Recipe)-[:starts_with]->(i:Instruction)-[:next_instruction*]->(i1)
RETURN r,i,i1
----
image::{imagesdir}/Instructions_graph.png[]
