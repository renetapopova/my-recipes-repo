= Modeling Recipes in 5 Simple Steps
:toc:
:toc-title:
:imagesdir: /images
:includedir: /cypher_queries

Cooking is an integral part of everyday life. Being able to quickly decide what you want to have for breakfast, lunch, and dinner, and with a click find a recipe that complies with your current diet, is the dream of every family. If you want to develop an application that can make millions of people happy by saving them time for their close ones, you are in the right spot.

Neo4j not only helps businesses simplify their data; it also gives them the power to store, manage, and retrieve information efficiently and flexibly.

Let me show you how easy it is to model a domain such as Food Recipes.

== Step 1: Create a Pancakes Recipe Model
[[anchor-1]]

You take a single recipe, and you write down its main parts. They will be your graph nodes:

* pancake
* almond flour
* coconut Flour
* eggs
* baking powder
* vanilla extract
* avocado oil
* sea salt
* recipe
* nutrition facts
* instructions

Then, you try to identify how these parts interact with each other, for example:

* pancake contains almond flour
* recipe has nutrition facts
* recipe is about pancakes
* etc.
===============================
*Tip*

The more relationships you find, the more information you will be able to retrieve afterward.
===============================
This is how you can model a recipe.

image::{imagesdir}/Recipe.png[]

== Step 2: Add Labels and Properties
[[anchor-2]]

Next, you add labels and properties to the nodes and relationships. You take them from the recipe structure.

image::{imagesdir}/Entities.png[]

== Step 3: Import the Graph Model in Neo4j
[[anchor-3]]

Now you use http://www.apcjones.com/arrows/#[Arrow Tool] to create the graph model of your recipe by adding the nodes and relationships from <<anchor-1,Step 1>> and <<anchor-1,2>>. The Export Cypher option creates a query that you can use to import the graph in Neo4j Browser.

include::{includedir}/create_all_nodes_rel.adoc[]

== Step 4: Show All Nodes and Relationships
[[anchor-4]]

You use the following query to visualise your graph.

[source,sql]
----
MATCH p = (n)-->() RETURN p
----

image::{imagesdir}/graph.png[]

If your model needs improving, follow the example in <<anchor-1,Step 3>> and modify the code in an editor.

== Step 5: Show Domain Schema
[[anchor-5]]

Finally, you come to the point where you can extract your graph schema and apply it to other recipes to enrich your database.

[source,sql]
----
call db.schema()
----

image::{imagesdir}/schema.png[]

== Let's Have Some Fun with the Data


=== Show me the Nutrition Facts of the "Pancakes" recipe

[source, sql]
----
MATCH (:Recipe {name: 'Pancakes'})-[:has_nutrition_facts]->(n:Nutrition_Facts)
RETURN n.`serving_size`,n.`calories`,n.`fat`,n.`protein`,n.`total carbs`
----
image::{imagesdir}/recipe_nutrition_facts.png[]

=== Give me the ingredients of a pancake
[source,sql]
----
MATCH (food:Food)-[:contains]->(Ingredient)
RETURN food.name AS Food, collect(Ingredient.name) AS Ingredients
----
image::{imagesdir}/recipe_ingredients.png[]

=== Give the quantity of each ingredient

[source,sql]
----
MATCH (food:Food)-[c:contains]-> (i:Ingredient)
RETURN  i.name AS Ingredient,c.quantity AS Quantity
ORDER BY c.quantity
----
image::{imagesdir}/ingredient_quantity.png[]

=== How to prepare pancakes with this recipe

[source,sql]
----
MATCH (r:Recipe)-[:starts_with]->(i:Instruction)-[:next_instruction*]->(i1)
RETURN r,i,i1
----
image::{imagesdir}/Instructions_graph.png[]
